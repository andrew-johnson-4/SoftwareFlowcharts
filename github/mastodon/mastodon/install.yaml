linux:
  prereq: "apt update"
  prereq: "apt install -y curl wget gnupg apt-transport-https lsb-release ca-certificates"
  prereq: "curl -sL https://deb.nodesource.com/setup_16.x | bash -"
  prereq: "wget -O /usr/share/keyrings/postgresql.asc https://www.postgresql.org/media/keys/ACCC4CF8.asc"
  prereq: 'echo "deb [signed-by=/usr/share/keyrings/postgresql.asc] http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/postgresql.list'
  prereq: "apt install -y imagemagick ffmpeg libpq-dev libxml2-dev libxslt1-dev file git-core"
  prereq: "apt install -y g++ libprotobuf-dev protobuf-compiler pkg-config nodejs gcc autoconf"
  prereq: "apt install -y bison build-essential libssl-dev libyaml-dev libreadline6-dev"
  prereq: "apt install -y zlib1g-dev libncurses5-dev libffi-dev libgdbm-dev"
  prereq: "apt install -y nginx redis-server redis-tools postgresql postgresql-contrib"
  prereq: "apt install -y certbot python3-certbot-nginx libidn11-dev libicu-dev libjemalloc-dev"
  prereq: "corepack enable"
  prereq: "yarn set version classic"
  prereq: "adduser --disabled-login mastodon"
  prereq: "su - mastodon"
  prereq: "git clone https://github.com/rbenv/rbenv.git ~/.rbenv"
  prereq: "cd ~/.rbenv && src/configure && make -C src"
  prereq: "echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bashrc"
  prereq: "echo 'eval "$(rbenv init -)"' >> ~/.bashrc"
  prereq: "exec bash"
  prereq: "git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build"
  prereq: "RUBY_CONFIGURE_OPTS=--with-jemalloc rbenv install 3.0.6"
  prereq: "rbenv global 3.0.6"
  prereq: "gem install bundler --no-document"
  prereq: "exit"
  prereq: "sudo -u postgres psql"
  prereq: "CREATE USER mastodon CREATEDB;"
  prereq: "\q"
  prereq: "su - mastodon"
  prereq: "git clone https://github.com/mastodon/mastodon.git live && cd live"
  prereq: "git checkout $(git tag -l | grep -v 'rc[0-9]*$' | sort -V | tail -n 1)"
  prereq: "bundle config deployment 'true'"
  prereq: "bundle config without 'development test'"
  prereq: "bundle install -j$(getconf _NPROCESSORS_ONLN)"
  prereq: "yarn install --pure-lockfile"
  prereq: "exit"
  prereq: "cp /home/mastodon/live/dist/nginx.conf /etc/nginx/sites-available/mastodon"
  prereq: "ln -s /etc/nginx/sites-available/mastodon /etc/nginx/sites-enabled/mastodon"
  prereq: "systemctl reload nginx"
  prereq: "certbot --nginx -d {domain}"
  prereq: "cp /home/mastodon/live/dist/mastodon-*.service /etc/systemd/system/"
  prereq: "systemctl daemon-reload"
  prereq: "systemctl enable --now mastodon-web mastodon-sidekiq mastodon-streaming"
  
  
